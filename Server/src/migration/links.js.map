{"version":3,"sources":["migration/links.ts"],"names":[],"mappings":";;AAAA,+BAAiC;AAEjC,sDAA8D;AAE9D,6CAAkD;AAClD,uDAAiD;AAQjD,MAAM,iBAAiB,GAA0B;IAC7C,OAAO,EAAE,gCAAgC;IACzC,GAAG,EAAE,yDAAyD;IAC9D,oBAAoB,EAAE,KAAK;IAC3B,IAAI,EAAE,QAAQ;IACd,OAAO,EAAE,uBAAuB;IAChC,UAAU,EAAE;QACR,GAAG,EAAE;YACD,OAAO,EAAE,4CAA4C;YACrD,OAAO,EAAE,gBAAQ;YACjB,IAAI,EAAE,QAAQ;SACjB;QACD,WAAW,EAAE;YACT,SAAS,EAAE,IAAI;YACf,OAAO,EAAE,0BAA0B;YACnC,IAAI,EAAE,QAAQ;SACjB;QACD,GAAG,EAAE;YACD,OAAO,EAAE,8CAA8C;YACvD,OAAO,EAAE,gBAAQ;YACjB,IAAI,EAAE,QAAQ;SACjB;QACD,IAAI,EAAE;YACF,SAAS,EAAE,GAAG;YACd,OAAO,EAAE,mCAAmC;YAC5C,SAAS,EAAE,CAAC;YACZ,IAAI,EAAE,QAAQ;SACjB;QACD,OAAO,EAAE;YACL,OAAO,EAAE,mCAAmC;YAC5C,OAAO,EAAE,CAAC;YACV,IAAI,EAAE,SAAS;SAClB;QACD,GAAG,EAAE;YACD,SAAS,EAAE,IAAI;YACf,OAAO,EAAE,qBAAqB;YAC9B,IAAI,EAAE,QAAQ;SACjB;KACJ;IACD,QAAQ,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,SAAS,CAAC;CACrD,CAAA;AAEY,QAAA,cAAc,GAAG,IAAI,CAAC,KAAM,SAAQ,sBAA4B;IAA1C;;QACtB,SAAI,GAAG,KAAK,CAAA;QAEZ,WAAM,GAAG,iBAAiB,CAAA;IA2BvC,CAAC;IAzBG,OAAO,CAAC,GAAQ;QACZ,MAAM,IAAI,GAAiB;YACvB,GAAG,EAAE,SAAI,EAAE;YACX,GAAG,EAAE,GAAG,CAAC,GAAG;YACZ,IAAI,EAAE,GAAG,CAAC,IAAI,IAAI,EAAE;YACpB,OAAO,EAAE,QAAQ,CAAC,GAAG,CAAC,OAAO,EAAE,EAAE,CAAC;YAClC,GAAG,EAAE,GAAG,CAAC,GAAG;SACf,CAAA;QAED,IAAI,GAAG,CAAC,WAAW,EAAE;YACjB,IAAI,CAAC,WAAW,GAAG,GAAG,CAAC,WAAW,CAAA;SACrC;QAED,MAAM,MAAM,GAAG,qBAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;QAE1C,IAAI,MAAM,EAAE;YACR,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAA;SAC1C;QAED,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAA;IAC5B,CAAC;IAED,OAAO;QACH,OAAO,OAAO,CAAC,OAAO,CAAO,SAAS,CAAC,CAAA;IAC3C,CAAC;CACJ,CAAC,EAAE,CAAA","file":"links.js","sourcesContent":["import { v4 as uuid } from 'uuid'\n\nimport { ISchema, uniqueId } from '../database/entities/utils'\nimport { IDbLink } from '../database/recording'\nimport { CollectionBase } from '../database/utils'\nimport { validate } from '../database/validation'\n\nexport interface IMigrateLink extends IDbLink {\n    _id: string\n    for: string\n    ordinal: number\n}\n\nconst MigrateLinkSchema: ISchema<IMigrateLink> = {\n    $schema: 'http://json-schema.org/schema#',\n    $id: 'http://psimarron.net/schemas/movie-db/migrate/link.json',\n    additionalProperties: false,\n    type: 'object',\n    message: 'Verweis unvollst채ndig',\n    properties: {\n        _id: {\n            message: 'Eindeutige Kennung fehlt oder ist ung체ltig',\n            pattern: uniqueId,\n            type: 'string',\n        },\n        description: {\n            maxLength: 2000,\n            message: 'Beschreibung ist zu lang',\n            type: 'string',\n        },\n        for: {\n            message: 'Aufzeichnungskennung fehlt oder ist ung체ltig',\n            pattern: uniqueId,\n            type: 'string',\n        },\n        name: {\n            maxLength: 100,\n            message: 'Name nicht angegeben oder zu lang',\n            minLength: 1,\n            type: 'string',\n        },\n        ordinal: {\n            message: 'Anordnung fehlt oder ist ung체ltig',\n            minimum: 0,\n            type: 'integer',\n        },\n        url: {\n            maxLength: 2000,\n            message: 'Verweis ist zu lang',\n            type: 'string',\n        },\n    },\n    required: ['_id', 'name', 'for', 'url', 'ordinal'],\n}\n\nexport const linkCollection = new (class extends CollectionBase<IMigrateLink> {\n    readonly name = 'n/a'\n\n    readonly schema = MigrateLinkSchema\n\n    fromSql(sql: any): void {\n        const link: IMigrateLink = {\n            _id: uuid(),\n            for: sql.For,\n            name: sql.Name || '',\n            ordinal: parseInt(sql.Ordinal, 10),\n            url: sql.Url,\n        }\n\n        if (sql.Description) {\n            link.description = sql.Description\n        }\n\n        const errors = validate(link, this.schema)\n\n        if (errors) {\n            throw new Error(JSON.stringify(errors))\n        }\n\n        this.cacheMigrated(link)\n    }\n\n    migrate(): Promise<void> {\n        return Promise.resolve<void>(undefined)\n    }\n})()\n"],"sourceRoot":"/home/jochenmanns/Software/git/MovieDBNode/Server/src"}