{"version":3,"sources":["database/validation.ts"],"names":[],"mappings":";;AAAA,2BAA0B;AAI1B,MAAM,OAAO,GAAG,8CAA8C,CAAA;AAE9D,MAAM,UAAU,GAAG,IAAI,GAAG,EAAE,CAAA;AAE5B,SAAgB,SAAS,CAAqC,MAAe;IACzE,SAAS,YAAY,CAAC,SAAiB;QACnC,IAAI,KAAK,GAAqB,MAAM,CAAA;QAEpC,MAAM,KAAK,GAAG,EAAE,CAAA;QAEhB,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;YACjC,MAAM,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;YAChC,MAAM,KAAK,GAAG,KAAK,IAAI,KAAK,CAAC,CAAC,CAAC,CAAA;YAE/B,IAAI,KAAK,EAAE;gBACP,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;gBAEjB,KAAK,GAAG,CAAC,KAAK,CAAC,UAAU,IAAI,EAAE,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,CAAA;aAChD;SACJ;QAED,OAAO,gCAAgC,SAAS,iBAAiB,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC;YAC5E,GAAG,gBAAgB,KAAK,CAAC,OAAO,IAAI,EAAE,SAAS,CAAA;IACvD,CAAC;IAED,UAAU,CAAC,eAAe,CAAC,YAAY,CAAC,CAAA;IACxC,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,CAAA;IAExC,UAAU,CAAC,eAAe,CAAC,SAAS,CAAC,CAAA;AACzC,CAAC;AAzBD,8BAyBC;AAED,SAAgB,QAAQ,CAAqC,MAAW,EAAE,MAAe;IACrF,IAAI;QACA,OAAY,UAAU,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,CAAA;KACtD;IAAC,OAAO,KAAK,EAAE;QACZ,OAAO;YACH;gBACI,UAAU,EAAE,WAAW;gBACvB,OAAO,EAAE,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,IAAI,QAAQ;gBACtE,QAAQ,EAAE,GAAG;aAChB;SACJ,CAAA;KACJ;AACL,CAAC;AAZD,4BAYC","file":"validation.js","sourcesContent":["import * as djv from 'djv'\n\nimport { IValidatableSchema, IValidationError, IValidationScope } from 'movie-db-api'\n\nconst propReg = /^\\[decodeURIComponent\\(['\"]([^'\"]+)['\"]\\)\\]$/\n\nconst validation = new djv()\n\nexport function addSchema<TSchema extends IValidatableSchema>(schema: TSchema): void {\n    function errorHandler(errorType: string): string {\n        let scope: IValidationScope = schema\n\n        const props = []\n\n        for (let prop of this.data.slice(1)) {\n            const match = propReg.exec(prop)\n            const found = match && match[1]\n\n            if (found) {\n                props.push(found)\n\n                scope = (scope.properties || {})[found] || {}\n            }\n        }\n\n        return `{ errors.push({ constraint: \"${errorType}\", property: \"${props.join('.') ||\n            '*'}\", message: \"${scope.message || ''}\" }); }`\n    }\n\n    validation.setErrorHandler(errorHandler)\n    validation.addSchema(schema.$id, schema)\n\n    validation.setErrorHandler(undefined)\n}\n\nexport function validate<TSchema extends IValidatableSchema>(object: any, schema: TSchema): IValidationError[] {\n    try {\n        return <any>validation.validate(schema.$id, object)\n    } catch (error) {\n        return [\n            {\n                constraint: 'validator',\n                message: typeof error === 'string' ? error : error.message || 'failed',\n                property: '*',\n            },\n        ]\n    }\n}\n"],"sourceRoot":"/home/jochenmanns/Software/git/MovieDBNode/Server/src"}