{"version":3,"sources":["database/series.ts"],"names":[],"mappings":";;;;;AAAA,8CAA2E;AAC3E,2CAAiD;AACjD,mCAAwC;AACxC,6CAAuC;AAEvC,uCAAiC;AAEpB,QAAA,gBAAgB,GAAG,IAAI,CAAC,KAAM,SAAQ,sBAAyB;IAAvC;;QACxB,SAAI,GAAG,uBAAc,CAAA;QAErB,WAAM,GAAG,qBAAY,CAAA;IAkClC,CAAC;IAhCG,OAAO,CAAC,GAAQ;QACZ,MAAM,MAAM,GAAc;YACtB,GAAG,EAAE,GAAG,CAAC,EAAE;YACX,IAAI,EAAE,GAAG,CAAC,IAAI,IAAI,EAAE;SACvB,CAAA;QAED,IAAI,GAAG,CAAC,WAAW,EAAE;YACjB,MAAM,CAAC,WAAW,GAAG,GAAG,CAAC,WAAW,CAAA;SACvC;QAED,IAAI,GAAG,CAAC,MAAM,EAAE;YACZ,MAAM,CAAC,QAAQ,GAAG,GAAG,CAAC,MAAM,CAAA;SAC/B;QAED,MAAM,MAAM,GAAG,qBAAQ,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;QAE5C,IAAI,MAAM,EAAE;YACR,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAA;SAC1C;QAED,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAA;IAC9B,CAAC;IAES,KAAK,CAAC,SAAS,CAAC,EAAU;QAChC,OAAO,+BAAmB,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,EAAE,OAAO,CAAC,CAAA;IAC3D,CAAC;IAES,KAAK,CAAC,UAAU,CAAC,EAAU;QACjC,MAAM,EAAE,GAAG,MAAM,IAAI,CAAC,aAAa,EAAE,CAAA;QAErC,MAAM,EAAE,CAAC,UAAU,CAAC,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,QAAQ,IAAI,EAAE,EAAE,EAAE,EAAE,MAAM,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,EAAE,CAAC,CAAA;IACnG,CAAC;CACJ,CAAC,EAAE,CAAA","file":"series.js","sourcesContent":["import { collectionName, IDbSeries, SeriesSchema } from './entities/series'\nimport { recordingCollection } from './recording'\nimport { CollectionBase } from './utils'\nimport { validate } from './validation'\n\nexport * from './entities/series'\n\nexport const seriesCollection = new (class extends CollectionBase<IDbSeries> {\n    readonly name = collectionName\n\n    readonly schema = SeriesSchema\n\n    fromSql(sql: any): void {\n        const series: IDbSeries = {\n            _id: sql.Id,\n            name: sql.Name || '',\n        }\n\n        if (sql.Description) {\n            series.description = sql.Description\n        }\n\n        if (sql.Parent) {\n            series.parentId = sql.Parent\n        }\n\n        const errors = validate(series, this.schema)\n\n        if (errors) {\n            throw new Error(JSON.stringify(errors))\n        }\n\n        this.cacheMigrated(series)\n    }\n\n    protected async canDelete(id: string): Promise<string> {\n        return recordingCollection.inUse('series', id, 'Serie')\n    }\n\n    protected async postDelete(id: string): Promise<void> {\n        const me = await this.getCollection()\n\n        await me.updateMany({ parentId: typeof id === 'string' && id }, { $unset: { parentId: null } })\n    }\n})()\n"],"sourceRoot":"/home/jochenmanns/Software/git/MovieDBNode/Server/src"}